@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.selfservicetimetopay.models.{Debit, CalculatorPaymentSchedule, ArrangementDirectDebit}
@import selfservicetimetopay.partials.{what_you_owe, direct_debit_details, payment_schedule, gaDoTransaction, currency}
@import java.time.format.DateTimeFormatter
@import java.time.LocalDate
@import java.util.Locale
@(debits: Seq[Debit], transactionId: String, directDebit: ArrangementDirectDebit, schedule: CalculatorPaymentSchedule, loggedIn: Boolean = false)(implicit messages: play.api.i18n.Messages, request: Request[_])

@gaCheckoutCode = {
@gaDoTransaction(debits = debits,
    id = transactionId,
    revenue = schedule.totalPayable,
    initialPayment = Some(schedule.initialPayment),
    interest = schedule.totalInterestCharged,
    duration = schedule.instalments.length,
    regularPayment = schedule.instalments.head.amount,
    step = 4,
    paymentDay = schedule.instalments.head.paymentDate.getDayOfMonth
)
}
@selfservicetimetopay.main(
    title = Messages("ssttp.arrangement.complete.title"),
    loggedIn = loggedIn,
    sidebarLinks = Some(selfservicetimetopay.partials.help_and_advice_sidebar()),
    googleAnalyticsCalls = Seq(gaCheckoutCode.body),
    hasUserPanel = true
) {
    <div class="transaction-banner--complete removeBottom">
        <div class="transaction-banner__heading" role="banner">@Messages("ssttp.arrangement.complete.title")</div>
    </div>
    <section class="section divider--bottom">
        <a href="javascript:window.print()" class="js-visible no-print   js-visible trackedPrintLink openOnPrint">@Messages("ssttp.arrangement.complete.print-label")</a>
        <br>
        <h2>@Messages("ssttp.arrangement.complete.next")</h2>
        <p>@Messages("ssttp.arrangement.complete.summary")</p>
        <p>@Messages("ssttp.arrangement.complete.first-payment")
            @defining(DateTimeFormatter.ofPattern("d MMMM yyyy", Locale.ENGLISH)) { formatter =>
            @schedule.startDate.get.format(formatter)}</p>
        <span><a href="https://www.tax.service.gov.uk/feedback-survey?origin=PWYOII">@Messages("ssttp.sidebar.help-and-advice.feedback.submit")</a></span>
    </section>
}

